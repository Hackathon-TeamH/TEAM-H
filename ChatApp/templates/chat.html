<!--動作確認用なので変更OKです-->
<!--正式なページ実装後は消す予定です-->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>chatpage</title>
    <link
      rel="stylesheet"
      href="{{url_for('static',filename='css/styles.css')}}"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Anta&family=Kosugi+Maru&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <div class="header_inner">
          <div class="header_icon">
            <ion-icon name="language-outline"></ion-icon>
          </div>
          <h1 class="header_title">OUR LANGUAGE</h1>
          <form action="{{url_for('add_channel')}}" method="POST">
            <input
              type="text"
              name="channel_name"
              placeholder="チャンネル名を入力してください"
            />
            <button type="submit">送信</button>
          </form>
          <a class="header_hamburger" href="#">
            <div class="hamburger_menu_button">
              <span></span><span></span><span></span>
            </div>
          </a>
        </div>
        <section class="hamburger_menu">
          <div class="button_container">
            <button class="menu_button">プロフィール</button>
            <button class="menu_button">チャットに参加する</button>
            <form action="/logout" method="POST">
              <button type="submit" class="menu_button">ログアウト</button>
            </form>
          </div>

          <h3>Menu</h3>
        </section>
      </div>
      <div class="channel_container">
        {% include "channel-list.html" %}
      </div>
      <div class="message_container">
        {% include "message.html" %}
      </div>
      <div class="input_box_area">
        <div class="input_box_wrapper">
          <form
            class="input_box"
            action="{{url_for('send_message')}}"
            method="POST"
            target="message_iframe"
          >
            <textarea
              name="message"
              placeholder="メッセージを入力してください"
            ></textarea>
            <input type="hidden" value="{{channel_id}}" name="channel_id" />
            <button type="submit">
              <ion-icon name="rocket-outline"></ion-icon>
            </button>
          </form>
        </div>
      </div>
    </div>

    <script
      type="module"
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"
    ></script>
    <script>
      //channel_listクラスの要素を変数listに格納
      const list = document.querySelectorAll(".channel_list");
      console.log(list);

      //liタグをひとつずつ変数itemに格納
      list.forEach((item) => {
        //itemがクリックされたときactive_link関数を呼び出す
        item.addEventListener("click", channel_activate);
      });

      //サブクラスactiveをリンクさせる関数
      function channel_activate() {
        list.forEach((item) => {
          //listの中身を1つずつ変数itemに格納
          item.classList.remove("active"); //acticeをremoveする
        });
        //クリックしたもの(this)のクラスにactiveをaddする
        this.classList.add("active");
      }

      document
        .querySelector(".hamburger_menu_button")
        .addEventListener("click", () => {
          document
            .querySelector(".hamburger_menu")
            .classList.toggle("active_hamburger_menu");
          document
            .querySelector(".hamburger_menu_button")
            .classList.toggle("active_menu");
        });
    </script>

    <script>
      //ページ読み込み時に自動で下までスクロールする
      window.onload = function () {
        const messageArea = document.getElementById("message_iframe");
        messageArea.scrollTop = messageArea.scrollHeight;
      };
    </script>

    <script>
      //lower_messageクラスの要素を変数listに格納
      const m_list = document.querySelectorAll(".lower_message");

      //liタグをひとつずつ変数itemに格納
      m_list .forEach((item) => {
          //itemがクリックされたときswitch_message関数を呼び出す
          item.addEventListener("click", switch_message);
      });

      function switch_message() {
          //クリックした要素のdata属性を取得
          const datavalue = this.dataset.hiddenMessage;
          //クリックした要素のinnerHTMLを取得
          const innervalue = this.innerHTML;
          //それぞれを入れ替えてセット
          this.dataset.hiddenMessage = innervalue;
          this.innerHTML = datavalue;
      }
        
    </script>

    <script>
       function message_reload(channel_id) {
            fetch("/reload/" + channel_id)
                .then(res => res.text())
                .then(html => {
                    document.getElementById("message_wrapper").innerHTML = html;
                })
                .catch(error => console.error('Error:', error));
        }
    </script>
  </body>
</html>
